# A01:2021 Broken Access Control

# IDOR: прямой доступ к корзине по ID
alert http any any -> $HOME_NET 3000 (msg:"[IDS] IDOR basket access attempt"; flow:to_server,established; http.uri; content:"/rest/basket/"; startswith; classtype:web-application-attack; sid:4501001; rev:1;)

# IDOR: последовательный перебор basket ID (enumeration)
alert http any any -> $HOME_NET 3000 (msg:"[IDS] IDOR basket enumeration detected"; flow:to_server,established; http.uri; content:"/rest/basket/"; startswith; threshold:type both, track by_src, count 3, seconds 10; classtype:web-application-attack; sid:4501002; rev:1;)

# A02:2021 Cryptographic Failures

# Доступ к FTP-директории
alert http any any -> $HOME_NET 3000 (msg:"[IDS] FTP directory access"; flow:to_server,established; http.uri; content:"/ftp/"; classtype:policy-violation; sid:4502001; rev:1;)

# Доступ к backup-файлам (.bak)
alert http any any -> $HOME_NET 3000 (msg:"[IDS] Backup file access attempt"; flow:to_server,established; http.uri; pcre:"/\.bak(\?|$|#)/i"; classtype:policy-violation; sid:4502002; rev:1;)

# Poison Null Byte в URI
alert http any any -> $HOME_NET 3000 (msg:"[IDS] Poison Null Byte detected"; flow:to_server,established; http.uri; pcre:"/%00|%2500/i"; classtype:web-application-attack; sid:4502003; rev:1;)

# Доступ к конфиденциальным файлам
alert http any any -> $HOME_NET 3000 (msg:"[IDS] Sensitive file access (coupons)"; flow:to_server,established; http.uri; content:"coupons"; nocase; classtype:policy-violation; sid:4502004; rev:1;)

# A03:2021 Injection

# SQL Injection: OR 1=1 в теле запроса
alert http any any -> $HOME_NET 3000 (msg:"[IDS] SQLi OR 1=1 detected"; flow:to_server,established; http.request_body; pcre:"/or\s+1\s*=\s*1/i"; classtype:web-application-attack; sid:4503001; rev:1;)

# SQL Injection: UNION SELECT в URI
alert http any any -> $HOME_NET 3000 (msg:"[IDS] SQLi UNION SELECT detected"; flow:to_server,established; http.uri; pcre:"/union\s+select/i"; classtype:web-application-attack; sid:4503002; rev:1;)

# SQL Injection: комментарий --
alert http any any -> $HOME_NET 3000 (msg:"[IDS] SQLi comment detected"; flow:to_server,established; http.request_body; content:"--"; classtype:web-application-attack; sid:4503003; rev:1;)

# Блокировка SQLi на endpoint /rest/user/login
drop http any any -> $HOME_NET 3000 (msg:"[IPS] SQLi blocked on login"; flow:to_server,established; http.uri; content:"/rest/user/login"; http.method; content:"POST"; http.request_body; pcre:"/or\s+1\s*=\s*1|union\s+select/i"; sid:4503101; rev:1;)
