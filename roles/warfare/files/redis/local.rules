# Обнаружение подключения к Redis (порт 6379)
alert tcp any any -> any 6379 (msg:"[IDS] Redis Unauthorized Access Detected"; flow:to_server,established; threshold:type limit,track by_src,count 1,seconds 300; classtype:policy-violation; sid:3000101; rev:1;)

# Обнаружение команды CONFIG
alert tcp any any -> any 6379 (msg:"[IDS] Redis CONFIG Command Detected"; flow:to_server,established; content:"CONFIG"; nocase; classtype:attempted-admin; sid:3000102; rev:1;)

# Обнаружение команды SAVE
alert tcp any any -> any 6379 (msg:"[IDS] Redis SAVE Command Detected"; flow:to_server,established; content:"SAVE"; nocase; classtype:attempted-admin; sid:3000103; rev:1;)

# Блокировка опасных операций (config set dir ...)
drop tcp any any -> any 6379 (msg:"[IPS] Redis Dangerous Operation Blocked - config set dir"; flow:to_server,established; content:"config set dir"; nocase; threshold:type limit,track by_src,count 1,seconds 60; classtype:attempted-admin; sid:3000104; rev:1;)

# Обнаружение попыток записи веб-шелла (например PHP)
alert tcp any any -> any 6379 (msg:"[IDS] Redis Web Shell Upload Attempt"; flow:to_server,established; content:"<?php"; nocase; classtype:trojan-activity; sid:3000105; rev:1;)

# Обнаружение манипуляций с dbfilename
alert tcp any any -> any 6379 (msg:"[IDS] Redis DBFilename Manipulation"; flow:to_server,established; content:"DBFILENAME"; nocase; classtype:attempted-admin; sid:3000106; rev:1;)

# Обнаружение команды FLUSHALL
alert tcp any any -> any 6379 (msg:"[IDS] Redis FLUSHALL Command Detected"; flow:to_server,established; content:"FLUSHALL"; nocase; classtype:attempted-admin; sid:3000107; rev:1;)

# Обнаружение большого количества операций (возможный брутфорс/скан)
alert tcp any any -> any 6379 (msg:"[IDS] Redis Multiple Operations Detected"; flow:to_server,established; threshold:type limit,track by_src,count 20,seconds 60; classtype:attempted-recon; sid:3000108; rev:1;)
