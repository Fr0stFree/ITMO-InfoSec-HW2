# Обнаружение ActiveMQ подключений
alert tcp any any -> any 61616 (msg:"[IDS] Apache ActiveMQ Connection Detected"; flow:to_server,established; threshold:type limit,track by_src,count 1,seconds 300; classtype:policy-violation; sid:3000001; rev:1;)

# Обнаружение OpenWire протокола
alert tcp any any -> any 61616 (msg:"[IDS] Apache ActiveMQ OpenWire Protocol Detected"; flow:to_server,established; content:"OpenWire"; nocase; classtype:policy-violation; sid:3000002; rev:1;)

# Обнаружение Java десериализации (ProcessBuilder)
alert tcp any any -> any 61616 (msg:"[IDS] ActiveMQ Java Deserialization CVE-2023-46604"; flow:to_server,established; content:"ProcessBuilder"; nocase; classtype:attempted-admin; sid:3000003; rev:1;)

# Блокировка подозрительных ActiveMQ запросов
drop tcp any any -> any 61616 (msg:"[IPS] ActiveMQ Exploit Attempt Blocked"; flow:to_server,established; content:"ClassPathXmlApplicationContext"; nocase; threshold:type limit,track by_src,count 1,seconds 60; classtype:attempted-admin; sid:3000004; rev:1;)

# Обнаружение Spring Beans в трафике
alert tcp any any -> any 61616 (msg:"[IDS] ActiveMQ Spring Beans Configuration Detected"; flow:to_server,established; content:"<beans"; nocase; classtype:attempted-admin; sid:3000005; rev:1;)